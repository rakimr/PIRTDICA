{% extends "base.html" %}

{% block title %}PIRTDICA - NBA DFS Challenge{% endblock %}

{% block content %}
<div class="hero">
    {% if next_game_iso %}
    <h1>GAME STARTS IN</h1>
    <div id="countdown-timer" class="countdown-display" data-target="{{ next_game_iso }}">
        <span id="countdown-hours">00</span>:<span id="countdown-minutes">00</span>:<span id="countdown-seconds">00</span>
    </div>
    {% else %}
    <h1>GAMES IN PROGRESS</h1>
    <div class="countdown-display">
        <span>LIVE</span>
    </div>
    {% endif %}
    {% if not user %}
        <div class="hero-buttons">
            <a href="/h2h" class="btn btn-primary btn-large">Coach vs Coach</a>
            <a href="/play" class="btn btn-secondary btn-large">Coach vs House</a>
        </div>
    {% else %}
        <a href="/play" class="btn btn-primary btn-large">Play Today's Contest</a>
    {% endif %}
</div>

<script>
(function() {
    const timerEl = document.getElementById('countdown-timer');
    if (!timerEl) return;
    
    const target = new Date(timerEl.dataset.target).getTime();
    const hoursEl = document.getElementById('countdown-hours');
    const minsEl = document.getElementById('countdown-minutes');
    const secsEl = document.getElementById('countdown-seconds');
    
    function update() {
        const now = Date.now();
        let diff = Math.max(0, Math.floor((target - now) / 1000));
        
        const h = Math.floor(diff / 3600);
        diff %= 3600;
        const m = Math.floor(diff / 60);
        const s = diff % 60;
        
        hoursEl.textContent = String(h).padStart(2, '0');
        minsEl.textContent = String(m).padStart(2, '0');
        secsEl.textContent = String(s).padStart(2, '0');
        
        if (target - now <= 0) {
            hoursEl.textContent = '00';
            minsEl.textContent = '00';
            secsEl.textContent = '00';
        }
    }
    
    update();
    setInterval(update, 1000);
})();
</script>

{% if contest %}
<section class="house-lineup-section">
    <h2>Today's Contest</h2>
    <p class="subtitle" id="lineup-date"></p>
    <script>
    (function(){
        const d = new Date();
        const opts = { year: 'numeric', month: 'long', day: '2-digit', timeZone: 'America/New_York' };
        document.getElementById('lineup-date').textContent = d.toLocaleDateString('en-US', opts);
    })();
    </script>
    
    {% if house_players %}
    <div class="lineup-totals">
        <span class="total-proj">House Projected: {{ "%.1f"|format(house_players|sum(attribute='proj_fp')) }} FP</span>
        {% if contest.status == 'completed' %}
        <span class="total-actual">House Actual: {{ "%.1f"|format(house_players|sum(attribute='actual_fp')) }} FP</span>
        {% endif %}
    </div>
    <p class="house-hint">Build your lineup and try to beat the house score!</p>
    {% else %}
    <p class="no-data">House lineup will be generated soon...</p>
    {% endif %}
    
    {% if user and user_entry %}
    <div class="your-entry">
        <h3>Your Entry</h3>
        <p>Projected: {{ "%.1f"|format(user_entry.proj_score) }} FP</p>
        {% if contest.status == 'completed' %}
        <p>Actual: {{ "%.1f"|format(user_entry.actual_score) }} FP</p>
        <p class="result {% if user_entry.beat_house %}win{% else %}loss{% endif %}">
            {% if user_entry.beat_house %}You Beat the House!{% else %}House Wins{% endif %}
        </p>
        {% endif %}
        <a href="/entry/{{ user_entry.id }}" class="btn btn-secondary">View Your Lineup</a>
    </div>
    {% endif %}
</section>
{% else %}
<section class="no-contest">
    {% if no_games_today %}
    <h2>No Games Today</h2>
    <p>The NBA schedule has no games today. Check back tomorrow!</p>
    {% else %}
    <h2>Lineup Coming Soon</h2>
    <p>Pirtdica is analyzing today's matchups. Check back shortly!</p>
    {% endif %}
</section>
{% endif %}

<section class="features">
    <h2>How It Works</h2>
    <div class="feature-grid">
        <div class="feature-card">
            <div class="feature-icon">1</div>
            <h3>The House Sets a Lineup</h3>
            <p>Every day, Pirtdica analyzes matchups, injuries, and trends to build its best 9-player lineup.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">2</div>
            <h3>You Build Yours</h3>
            <p>Pick 9 players within the $60,000 salary cap. Use our projections or go with your gut.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">3</div>
            <h3>Games Play Out</h3>
            <p>Watch the NBA games and see how your lineup performs vs the house.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">4</div>
            <h3>Climb the Ranks</h3>
            <p>Beat the house to earn coins, achievements, and climb the Coach leaderboard!</p>
        </div>
    </div>
</section>
{% endblock %}
