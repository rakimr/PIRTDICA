{% extends "base.html" %}

{% block title %}Beat This Lineup - NBA DFS Challenge{% endblock %}

{% block content %}
<div class="hero">
    <h1>Can You Beat This Lineup?</h1>
    <p>Every day, our AI builds what it thinks is the winning lineup. Think you know better?</p>
    {% if not user %}
        <div class="hero-buttons">
            <a href="/register" class="btn btn-primary btn-large">Start Playing Free</a>
            <a href="/leaderboard" class="btn btn-secondary btn-large">View Leaderboard</a>
        </div>
    {% else %}
        <a href="/play" class="btn btn-primary btn-large">Play Today's Contest</a>
    {% endif %}
</div>

{% if contest %}
<section class="house-lineup-section">
    <h2>Today's House Lineup</h2>
    <p class="subtitle">{{ contest.slate_date.strftime('%B %d, %Y') }}</p>
    
    {% if house_players %}
    <div class="lineup-horizontal">
        {% for player in house_players %}
        <div class="player-card">
            <div class="player-image">
                {% if headshots.get(player.player_name) %}
                <img src="{{ headshots.get(player.player_name) }}" alt="{{ player.player_name }}" onerror="this.src='https://ui-avatars.com/api/?name={{ player.player_name|urlencode }}&background=6366f1&color=fff&size=80&font-size=0.35&bold=true'">
                {% else %}
                <img src="https://ui-avatars.com/api/?name={{ player.player_name|urlencode }}&background=6366f1&color=fff&size=80&font-size=0.35&bold=true" alt="{{ player.player_name }}">
                {% endif %}
            </div>
            <div class="player-position">{{ player.position }}</div>
            <div class="player-name">{{ player.player_name.split(' ')[-1] }}</div>
            <div class="player-team">{{ player.team }}</div>
            <div class="player-salary">${{ "{:,}".format(player.salary) }}</div>
            {% if contest.status == 'completed' %}
            <div class="player-fp {% if player.actual_fp > player.proj_fp %}positive{% else %}negative{% endif %}">
                {{ "%.1f"|format(player.actual_fp) }} FP
            </div>
            {% else %}
            <div class="player-fp">{{ "%.1f"|format(player.proj_fp) }} FP</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <div class="lineup-totals">
        <span class="total-salary">Total Salary: ${{ "{:,}".format(house_players|sum(attribute='salary')) }}</span>
        <span class="total-proj">Projected: {{ "%.1f"|format(house_players|sum(attribute='proj_fp')) }} FP</span>
        {% if contest.status == 'completed' %}
        <span class="total-actual">Actual: {{ "%.1f"|format(house_players|sum(attribute='actual_fp')) }} FP</span>
        {% endif %}
    </div>
    {% else %}
    <p class="no-data">House lineup will be generated soon...</p>
    {% endif %}
    
    {% if user and user_entry %}
    <div class="your-entry">
        <h3>Your Entry</h3>
        <p>Projected: {{ "%.1f"|format(user_entry.proj_score) }} FP</p>
        {% if contest.status == 'completed' %}
        <p>Actual: {{ "%.1f"|format(user_entry.actual_score) }} FP</p>
        <p class="result {% if user_entry.beat_house %}win{% else %}loss{% endif %}">
            {% if user_entry.beat_house %}You Beat the House!{% else %}House Wins{% endif %}
        </p>
        {% endif %}
        <a href="/entry/{{ user_entry.id }}" class="btn btn-secondary">View Your Lineup</a>
    </div>
    {% elif user %}
    <a href="/play" class="btn btn-primary">Submit Your Lineup</a>
    {% endif %}
</section>
{% else %}
<section class="no-contest">
    <h2>No Contest Today</h2>
    <p>Check back when games are scheduled!</p>
</section>
{% endif %}

<section class="features">
    <h2>How It Works</h2>
    <div class="feature-grid">
        <div class="feature-card">
            <div class="feature-icon">1</div>
            <h3>The House Sets a Lineup</h3>
            <p>Every day, our AI analyzes matchups, injuries, and trends to build its best 9-player lineup.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">2</div>
            <h3>You Build Yours</h3>
            <p>Pick 9 players within the $60,000 salary cap. Use our projections or go with your gut.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">3</div>
            <h3>Games Play Out</h3>
            <p>Watch the NBA games and see how your lineup performs vs the house.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">4</div>
            <h3>Climb the Ranks</h3>
            <p>Beat the house to earn coins, achievements, and climb the Coach leaderboard!</p>
        </div>
    </div>
</section>
{% endblock %}
